# command prefix (like screen)
set -g prefix C-a
unbind C-b
bind C-a send-prefix # Passthrough Crtl+a

# Reload Tmux Conf
bind r source-file $XDG_CONFIG_HOME/tmux/tmux.conf \; display "Configuration Reloaded"

# Ensure https://github.com/tmux-plugins/tpm is installed
# Ensure Plugins are loaded with prefix r, prefix I

# Cache plugins away from the config directory
# This avoids an issue where the plugin git repos were not working
# when the config directory was synced across machines
set-environment -g TMUX_PLUGIN_MANAGER_PATH "$XDG_STATE_HOME/tmux/plugins/"

set -g @plugin 'tmux-plugins/tpm'
# usage: prefix I to install plugins
# usage: prefix U to update plugins
# usage: prefix alt-u to remove plugins not in the list

# set -g @plugin 'tmux-plugins/tmux-cpu'

set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @vim_navigator_mapping_left "C-Left C-h"  # use C-h and C-Left
set -g @vim_navigator_mapping_right "C-Right C-l"
set -g @vim_navigator_mapping_up "C-k"
set -g @vim_navigator_mapping_down "C-j"
set -g @vim_navigator_mapping_prev ""  # removes the C-\ binding
set -g @vim_navigator_prefix_mapping_clear_screen ""

set -g @plugin 'sainnhe/tmux-fzf'
# usage: prefix F

set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-strategy-nvim 'session'
# usage: prefix Ctrl-s to save the session
# usage: prefix Ctrl-r to restore the session

set -g @plugin 'tmux-plugins/tmux-continuum'
# Auto save sessions every 15 minutes

# Helper to show the status of the plugins
# set -g @plugin 'phil/tmux-plugins-check'

set -g @plugin "phil/tmux-devcontainers"
# usage: prefix E to create a window and exec onto the container
# usage: prefix C-E to show the command menu

set -g mouse on
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# Basic settings
set -sg escape-time 0
set -g default-terminal "xterm-256color"

# Base settings
set -g base-index 1
setw -g pane-base-index 1
# set -g renumber-windows on

# Splitting Panes
bind | split-window -h
bind - split-window -v

# arrange panes equally
bind = select-layout even-horizontal

## window title
set-option -g set-titles on

set-option -g pane-active-border-style fg=white
set-option -g pane-border-lines double
set-option -g pane-border-indicators arrows
set-option -g pane-border-status top

set-option -g popup-border-style fg=white
set-option -g popup-border-lines double

set-option -g menu-border-style fg=white
set-option -g menu-border-lines double

# status bar
set-option -g status-left-length 30
set-option -g status-right-length 150
set-option -g status-interval 60
set-option -g status-left '#[bg=colour236]#[fg=white,bold] #S '
set-option -g status-right '#{tmux_plugins_status} #[fg=black,bold]#{devcontainers_workspace} #[fg=default,nobold]#{devcontainers_status} '

# Window Status
set-window-option -g window-status-separator ""

set-window-option -g window-status-style fg=color0,bold,bg=color2
set-window-option -g window-status-current-style fg=white,bold,bg=color0

set-window-option -g window-status-format " #I:#W#{?window_flags,#{window_flags}, } "
set-window-option -g window-status-current-format " #I:#W#{?window_flags,#{window_flags}, } "

set-window-option -g window-status-activity-style fg=color3,bg=color2
set-window-option -g window-status-bell-style fg=color1,bg=color2

set-option -g visual-activity off 

set -g display-time 3000

# Refresh Status Bar
bind R refresh-client -S

# LazyGit
bind C-y display-popup \
  -d "#{pane_current_path}" \
  -w 80% \
  -h 80% \
  -E "lazygit"

# Simple Session Switcher
bind C-a display-popup -E "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t" 


# TODO: automatically load the TPM plugin manager
# if "test ! -d ~/.tmux/plugins/tpm" \
#   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Load Plugins as the last thing
run "$XDG_STATE_HOME/tmux/plugins/tpm/tpm"
